C51 COMPILER V9.57.0.0   GYRO                                                              03/26/2023 11:58:52 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE GYRO
OBJECT MODULE PLACED IN .\Objects\GYRO.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE include\GYRO.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\include) DEBUG OB
                    -JECTEXTEND PRINT(.\Listings\GYRO.lst) TABS(2) OBJECT(.\Objects\GYRO.obj)

line level    source

   1          #include "GYRO.h"
   2          #include "Uart1.h"
*** WARNING C318 IN LINE 2 OF include\GYRO.c: can't open file 'Uart1.h'
   3          
   4          
   5          
   6          
   7          
   8          static void delay_us(unsigned int ms)
   9          {
  10   1        while(ms--);
  11   1      }
  12          
  13          //**************************************
  14          //I2C起始信号
  15          //**************************************
  16          void I2C_Start()
  17          {
  18   1          Gyro_SDA = 1;                    //拉高数据线
  19   1          Gyro_SCK = 1;                    //拉高时钟线
  20   1          delay_us(1);                 //延时
  21   1          Gyro_SDA = 0;                    //产生下降沿
  22   1          delay_us(1);                 //延时
  23   1          Gyro_SCK = 0;                    //拉低时钟线
  24   1      }
  25          //**************************************
  26          //I2C停止信号
  27          //**************************************
  28          void I2C_Stop()
  29          {
  30   1          Gyro_SCK = 0;                    //拉高时钟线
  31   1          Gyro_SDA = 0;                    //拉低数据线
  32   1          delay_us(1);                 //延时
  33   1          Gyro_SCK = 1;                    //拉高时钟线
  34   1          delay_us(1);                 //延时
  35   1          Gyro_SDA = 1;                    //产生上升沿
  36   1          delay_us(1);                 //延时
  37   1      }
  38          //**************************************
  39          //I2C发送应答信号
  40          //入口参数:ack (0:ACK 1:NAK)
  41          //**************************************
  42          void I2C_SendACK(unsigned char ack)
  43          {
  44   1          Gyro_SDA = ack;                  //写应答信号
  45   1          Gyro_SCK = 1;                    //拉高时钟线
  46   1          delay_us(1);                 //延时
  47   1          Gyro_SCK = 0;                    //拉低时钟线
  48   1          delay_us(1);                 //延时
  49   1      }
  50          //**************************************
  51          //I2C接收应答信号
  52          //**************************************
  53          unsigned char I2C_RecvACK()
C51 COMPILER V9.57.0.0   GYRO                                                              03/26/2023 11:58:52 PAGE 2   

  54          {
  55   1        unsigned char res = 0;
  56   1        
  57   1          Gyro_SCK = 1;                    //拉高时钟线
  58   1          delay_us(1);                 //延时
  59   1          res = Gyro_SDA;                   //读应答信号
  60   1          Gyro_SCK = 0;                    //拉低时钟线
  61   1          delay_us(1);                 //延时
  62   1        
  63   1          return res;
  64   1      }
  65          //**************************************
  66          //向I2C总线发送一个字节数据
  67          //**************************************
  68          void I2C_SendByte(unsigned char dat)
  69          {
  70   1        unsigned char i;
  71   1        unsigned char res = 0;
  72   1        
  73   1        res = dat;
  74   1        for (i=0; i<8; i++)         //8位计数器
  75   1        {
  76   2          if(res & 0x80)
  77   2          {
  78   3            Gyro_SDA = 1;               //送数据口
  79   3          }else
  80   2          {
  81   3            Gyro_SDA = 0;               //送数据口
  82   3          }
  83   2          
  84   2          Gyro_SCK = 1;                //拉高时钟线
  85   2          delay_us(1);             //延时
  86   2          Gyro_SCK = 0;                //拉低时钟线
  87   2          delay_us(1);             //延时
  88   2          res <<= 1;              //移出数据的最高位
  89   2        }
  90   1        I2C_RecvACK();
  91   1      }
  92          //**************************************
  93          //从I2C总线接收一个字节数据
  94          //**************************************
  95          unsigned char I2C_RecvByte()
  96          {
  97   1          unsigned char i;
  98   1          unsigned char dat = 0;
  99   1        
 100   1          Gyro_SDA = 1;                    //使能内部上拉,准备读取数据,
 101   1          for (i=0; i<8; i++)         //8位计数器
 102   1          {
 103   2              dat <<= 1;
 104   2              Gyro_SCK = 1;                //拉高时钟线
 105   2              delay_us(1);             //延时
 106   2              dat |= Gyro_SDA;             //读数据               
 107   2              Gyro_SCK = 0;                //拉低时钟线
 108   2              delay_us(1);             //延时
 109   2          }
 110   1          
 111   1          return dat;
 112   1      }
 113          
 114          
 115          
C51 COMPILER V9.57.0.0   GYRO                                                              03/26/2023 11:58:52 PAGE 3   

 116          
 117          
 118          
 119          
 120          
 121          
 122          //**************************************
 123          //向I2C设备写入一个字节数据
 124          //**************************************
 125          void Single_WriteI2C(unsigned char REG_Address,unsigned char REG_data)
 126          {
 127   1          I2C_Start();                  //起始信号
 128   1          I2C_SendByte(SlaveAddress);   //发送设备地址+写信号
 129   1          I2C_SendByte(REG_Address);    //内部寄存器地址，
 130   1          I2C_SendByte(REG_data);       //内部寄存器数据，
 131   1          I2C_Stop();                   //发送停止信号
 132   1      }
 133          //**************************************
 134          //从I2C设备读取一个字节数据
 135          //**************************************
 136          unsigned char Single_ReadI2C(unsigned char REG_Address)
 137          {
 138   1        unsigned char REG_data;
 139   1        
 140   1        I2C_Start();                   //起始信号
 141   1        I2C_SendByte(SlaveAddress);    //发送设备地址+写信号
 142   1        I2C_SendByte(REG_Address);     //发送存储单元地址，从0开始  
 143   1        I2C_Start();                   //起始信号
 144   1        I2C_SendByte(SlaveAddress+1);  //发送设备地址+读信号
 145   1        REG_data=I2C_RecvByte();       //读出寄存器数据
 146   1        I2C_SendACK(1);                //接收应答信号
 147   1        I2C_Stop();                    //停止信号
 148   1        return REG_data;
 149   1      }
 150          
 151          
 152          
 153          
 154          
 155          
 156          
 157          //**************************************
 158          //初始化MPU6050
 159          //**************************************
 160          void InitMPU6050(void)
 161          {
 162   1        Single_WriteI2C(PWR_MGMT_1, 0x00);  //解除休眠状态
 163   1        Single_WriteI2C(SMPLRT_DIV, 0x07);
 164   1        Single_WriteI2C(CONFIG, 0x06);
 165   1        Single_WriteI2C(GYRO_CONFIG, 0x18);
 166   1        Single_WriteI2C(ACCEL_CONFIG, 0x01);
 167   1      }
 168          //**************************************
 169          //合成数据
 170          //**************************************
 171          int GetData(unsigned char REG_Address)
 172          {
 173   1        unsigned char H,L;
 174   1        H=Single_ReadI2C(REG_Address);
 175   1        L=Single_ReadI2C(REG_Address+1);
 176   1        return (H<<8)+L;   //合成数据
 177   1      }
C51 COMPILER V9.57.0.0   GYRO                                                              03/26/2023 11:58:52 PAGE 4   



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    282    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       1
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
